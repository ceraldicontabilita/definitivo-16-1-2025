<analysis>**original_problem_statement:**
L'utente ha una serie di richieste per un'applicazione ERP/contabilità, con una logica in continua evoluzione.

**Requisiti Iniziali (Superati):**
*   Correzione di un bug contabile critico (RISOLTO).
*   Implementazione di un modulo HACCP completo (RISOLTO).
*   Stile UI basato su Tailwind CSS (ABBANDONATO su richiesta dell'utente).

**Requisiti Attuali:**
1.  **(P1) Uniformità Stile UI Inline:** L'utente ha richiesto esplicitamente di refattorizzare **tutta l'applicazione** per usare stili JavaScript inline (), abbandonando  e Tailwind CSS. Lo stile di riferimento è quello della pagina .
2.  **(P0) Integrazione Totale Ciclo Passivo:** Questa è la richiesta più recente e a massima priorità. L'utente ha fornito specifiche dettagliate per creare un flusso di lavoro completamente integrato per le fatture passive importate via XML. Il flusso deve collegare:
    *   **Importazione XML:** Parsing, gestione allegati PDF, controllo duplicati e validazione totali.
    *   **Magazzino:** Carico automatico della merce e creazione dei lotti.
    *   **Contabilità:** Generazione automatica delle scritture in Prima Nota (Dare/Avere).
    *   **Scadenziario:** Creazione automatica delle scadenze di pagamento.
    *   **Riconciliazione:** Funzionalità per abbinare le fatture ai movimenti bancari e segnarle come saldate.
    *   **Produzione:** Garantire la tracciabilità dei lotti dalle materie prime al prodotto finito.

**User's preferred language**: Italiano

**what currently exists?**
L'applicazione è un ERP complesso con moduli per contabilità, fatturazione, magazzino e HACCP. L'agente ha recentemente completato due task importanti:
1.  **Automazione HACCP:** Lo scheduler () è stato corretto per popolare automaticamente i registri HACCP ogni giorno e il parser di fatture XML () è stato migliorato per estrarre i codici lotto.
2.  **Nuovo Sistema di Importazione Fatture:** È stato creato da zero un sistema robusto e stabile per l'importazione delle fatture passive XML () secondo le specifiche dell'utente, inclusa una nuova pagina frontend () per la gestione.

Inoltre, è in corso un massiccio lavoro di refactoring stilistico per convertire l'intera UI all'uso di stili inline.

**Last working item**:
- **Last item agent was working**: L'agente aveva appena ricevuto la nuova, complessa richiesta dell'utente per l'**Integrazione Totale del Ciclo Passivo**. Aveva iniziato la fase di pianificazione ed esplorazione, creando il file scheletro  e analizzando i router esistenti per magazzino, prima nota e scadenziario per capire come collegarli.
- **Status**: NOT STARTED
- **Agent Testing Done**: N
- **Which testing method agent to use?**: both. Questa feature richiede test approfonditi del backend per verificare il corretto flusso di dati tra le varie collection (con  e script di verifica DB). Sarà necessario anche un test frontend (con screenshot tool) per la Dashboard di Riconciliazione suggerita dall'utente.
- **User Testing Done**: N

**All Pending/In progress Issue list**:
Nessun problema bloccante. I task pendenti sono funzionalità da implementare o completare.

**In progress Task List**:
- **Task 1: (P1) Uniformare lo stile UI all'approccio Inline-JS**
  - **Where to resume**: L'agente ha convertito con successo 56 pagine su 67. Le restanti ~11 pagine devono essere aggiornate. Le più complesse sono ,  e .
  - **What will be achieved with this?**: Un'interfaccia utente stilisticamente coerente in tutta l'applicazione, secondo il requisito vincolante dell'utente.
  - **Status**: IN PROGRESS
  - **Should Test frontend/backend/both after fix?**: frontend
  - **Blocked on something**: None

**Upcoming and Future Tasks**
*   **Upcoming Tasks**:
    *   **(P0) Implementare Integrazione Totale Ciclo Passivo:** Questo è il task principale. È necessario sviluppare la logica nel file  e modificare il router  per orchestrare il flusso:
        1.  **Magazzino:** Incrementare lo stock e creare i lotti.
        2.  **Prima Nota:** Generare le scritture contabili.
        3.  **Scadenziario:** Creare le scadenze di pagamento.
        4.  **Riconciliazione:** Sviluppare la logica di matching con i movimenti bancari e creare la UI suggerita.

*   **Future Tasks**:
    *   **(P2)** Completare la conversione stilistica delle ultime pagine rimanenti.
    *   **(P2)** Rimuovere codice morto: la cartella  e potenzialmente il router .
    *   **(P2)** Risolvere bug legacy: ricerca in .
    *   **(P2)** Consolidare la logica di calcolo dell'IVA.

**Completed work in this session**
- **Automazione HACCP (Scheduler & Parser) (DONE):** Lo scheduler ora funziona correttamente all'orario richiesto (00:01) e popola le collection corrette. Il parser estrae i lotti dalle fatture. Funzionalità testata manualmente con successo.
- **Ristrutturazione Importazione Fatture (DONE):** Creato un nuovo sistema stabile per l'importazione di fatture XML passive, con logica di validazione, gestione PDF e una nuova UI dedicata (), come da specifiche.
- **Uniformazione Stile UI (Parzialmente Completata):** Convertite con successo 56 pagine allo stile inline, incluse le pagine chiave come , , ,  e le varie . Sono stati corretti anche diversi errori di sintassi introdotti durante il processo.

**Earlier issues found/mentioned but not fixed**
- Bug nella ricerca .
- Logica di calcolo dell'IVA da consolidare.

**Known issue recurrence from previous fork**
- None.

**Code Architecture**


**Key Technical Concepts**
- Backend: FastAPI, MongoDB, APScheduler.
- Frontend: React.
- **Styling**: **Stili JavaScript inline () OBBLIGATORI**. L'uso di  o Tailwind CSS è stato esplicitamente vietato.

**key DB schema**
- : Collection per le fatture passive, con stato ('OK', 'Anomala'), righe e PDF allegato.
- : Anagrafica fornitori con  come chiave univoca.
- : Anagrafica prodotti magazzino con campo .
- : Scritture contabili.
- : Scadenze di pagamento.
- Le varie collection del modulo HACCP v2 (, , etc.).

**All files of reference**
-  (Punto di partenza per il nuovo task P0).
-  (Logica di importazione fatture esistente).
-  (Riferimento per lo stile UI).
-  (Contiene tutti i requisiti, inclusi quelli nuovi).

**Areas that need refactoring**:
- **Stile UI Globale:** Le ~11 pagine rimanenti devono essere convertite allo stile inline per completare la richiesta dell'utente.
- **Codice Morto:** La cartella  è inutilizzata e andrebbe rimossa. Verificare se  è stato completamente sostituito e può essere eliminato.

**key api endpoints**
- : (POST) Nuovo endpoint per l'upload delle fatture.
- : (GET) Endpoint per la nuova pagina Archivio Fatture.
- : (POST) Endpoint di test per l'esecuzione manuale dello scheduler HACCP.

**Critical Info for New Agent**
- **PRIORITÀ ASSOLUTA (P0): Implementare il Ciclo Passivo Integrato**. Questa è la richiesta più recente, dettagliata e importante dell'utente. Devi concentrarti sulla creazione della logica che collega l'importazione di una fattura (XML) all'aggiornamento del magazzino, alla contabilità (Prima Nota), allo scadenziario e alla riconciliazione bancaria. Inizia lavorando sul file .
- **STILE UI OBBLIGATORIO: USARE SOLO STILI JAVASCRIPT INLINE ()**. Non usare  o Tailwind CSS. Qualsiasi modifica alla UI deve seguire questo standard. Il refactoring delle pagine rimanenti è un task secondario (P1).

**documents and test reports created in this job**
-  (aggiornato)

**Last 10 User Messages and any pending HUMAN messages**
- L'utente ha approvato il proseguimento dei lavori.
- L'utente ha fornito una specifica molto dettagliata per un nuovo sistema di importazione fatture.
- L'agente ha implementato il sistema e ha mostrato il risultato.
- L'utente ha chiesto di continuare con l'uniformazione dello stile UI.
- L'agente ha lavorato a lungo sul refactoring della UI, convertendo molte pagine.
- L'utente ha chiesto nuovamente di continuare con l'uniformazione.
- L'agente ha convertito altre pagine.
- **Infine, l'utente ha interrotto il lavoro sulla UI per assegnare un nuovo task enorme e a massima priorità: Integrazione Totale Ciclo Passivo, Magazzino e Prima Nota. Questa è l'ultima e più importante richiesta da affrontare.**

**Project Health Check:**
- **Broken**: Nessuno.
- **Mocked**: Nessuno.
- **Technical Debt**: **Alta**. La scelta di usare stili inline per l'intera applicazione rende la manutenzione del frontend più complessa. Il nuovo Ciclo Passivo Integrato aggiungerà una notevole complessità al backend che dovrà essere gestita con attenzione.

**3rd Party Integrations**
- , : Per la gestione di file Excel/CSV.
- : Per il parsing delle fatture XML.
- : Per i task schedulati.
- : Libreria di icone utilizzata nel frontend.

**Testing status**
- **Testing agent used after significant changes**: NO (in questa sessione).
- **Troubleshoot agent used after agent stuck in loop**: NO.
- **Test files created**: Nessuno.
- **Known regressions**: Nessuna. L'agente ha individuato e corretto gli errori di sintassi introdotti durante il refactoring della UI.

**Credentials to test flow:**
Non sono necessarie credenziali specifiche.

**What agent forgot to execute**
L'agente non ha dimenticato nulla. Ha seguito le direttive dell'utente, anche quando queste hanno comportato cambi di rotta radicali. Stava per iniziare a implementare l'ultima, grande richiesta dell'utente quando la sessione è terminata.</analysis>
