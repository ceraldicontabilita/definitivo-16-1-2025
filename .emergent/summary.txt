<analysis>**original_problem_statement:**
L'utente ha segnalato una serie di bug critici e richiesto numerose funzionalità per migliorare l'applicazione di contabilità. Le richieste principali includono:
-   **Logica Contabile (P0):** Refactoring completo della Prima Nota per separare CASSA e BANCA, con una logica DARE/AVERE non convenzionale.
-   **Gestione Buste Paga (P0):** Implementazione di un sistema per importare dati storici da file Excel (, ) e futuri da PDF, con una pagina di riconciliazione.
-   **Validatori Bloccanti (P0):** Introdurre validatori durante l'import delle fatture per bloccare le operazioni se un fornitore non ha un metodo di pagamento o un IBAN (se necessario). Inoltre, bloccare i pagamenti di stipendi in contanti a partire da luglio 2018.
-   **Gestione Fornitori:** Risolvere errori 404, problemi di modifica e ricerca. Implementare una funzione di aggiornamento di massa per arricchire i dati dei fornitori (IBAN, anagrafiche) da fonti esterne.
-   **Correzione Bug:** Risolvere un errore 400 sulla conferma multipla di fatture, problemi nella visualizzazione degli F24 pendenti e l'importazione di file XML dei corrispettivi (mancata estrazione del pagamento elettronico).
-   **Refactoring UI/UX:** Replicare il design delle pagine Prima Nota Cassa/Banca e creare una nuova pagina Prima Nota Salari basandosi su un progetto di riferimento fornito dall'utente.
-   **Automatizzazione:** Creare un processo automatico che, ogni 30 minuti, tenti di riconciliare le fatture non pagate con gli estratti conto bancari.

**User's preferred language**: Italiano

**what currently exists?**
L'applicazione ora dispone di una logica contabile personalizzata con registri di Cassa e Banca separati. Le pagine Prima Nota e Prima Nota Salari sono state completamente ridisegnate per corrispondere alle specifiche dell'utente, utilizzando componenti React modulari e uno store Zustand. Sono stati implementati validatori P0 bloccanti durante l'import delle fatture e il pagamento dei salari per garantire l'integrità dei dati secondo le regole aziendali.

Sono state corrette numerose problematiche, tra cui il bug sulla conferma multipla delle fatture, la visualizzazione degli F24, e l'importazione di corrispettivi e cedolini da file Excel. È stata implementata una funzione di riconciliazione automatica con auto-refresh e un endpoint per l'aggiornamento di massa dei dati dei fornitori. La gestione dei fornitori è stata migliorata correggendo bug nella UI e aggiungendo una funzione per sincronizzare gli IBAN dalle fatture esistenti.

**Last working item**:
-   **Last item agent was working**: L'agente stava implementando la richiesta dell'utente di un pulsante per l'aggiornamento in blocco di tutti i fornitori. L'agente ha creato con successo l'endpoint backend , ma è stato interrotto prima di poter aggiungere il pulsante e la relativa logica nel frontend ().
-   **Status**: IN PROGRESS
-   **Agent Testing Done**: N
-   **Which testing method agent to use?**: both
-   **User Testing Done**: N

**All Pending/In progress Issue list**:
-   **Issue 1: (P0) Completare l'implementazione dell'aggiornamento in blocco dei fornitori.**
-   **Issue 2: (P0) 231 fornitori con metodo di pagamento bancario sono privi di IBAN.**
-   **Issue 3: (P1) L'utente segnala ancora errori 404 generici durante l'uso dell'applicazione.**
-   **Issue 4: (P2) Svuotare file PDF residui dal repository per liberare spazio.**

**Issues Detail**:
-   **Issue 1: Completare l'aggiornamento in blocco dei fornitori**
    -   **Attempted fixes**: È stato creato l'endpoint backend .
    -   **Next debug checklist**:
        1.  Modificare .
        2.  Aggiungere un pulsante Aggiorna Tutti i Dati.
        3.  Collegare il pulsante all'endpoint .
        4.  Implementare un indicatore di caricamento durante l'operazione e una notifica (toast) per comunicare il risultato (es. X fornitori aggiornati, Y falliti).
    -   **Why fix this issue and what will be achieved with the fix?**: Fornirà una soluzione rapida per arricchire i dati anagrafici dei fornitori, risolvendo i problemi di IBAN mancanti e riducendo gli errori manuali.
    -   **Status**: IN PROGRESS
    -   **Is recurring issue?**: N
    -   **Should Test frontend/backend/both after fix?**: both
    -   **Blocked on other issue**: No

-   **Issue 2: 231 fornitori con metodo di pagamento bancario sono privi di IBAN**
    -   **Attempted fixes**: È stato eseguito un endpoint () che ha corretto 17 fornitori trovando l'IBAN nelle fatture XML importate.
    -   **Next debug checklist**:
        1.  Completare l'Issue 1 (strumento di aggiornamento bulk).
        2.  Eseguire l'aggiornamento bulk e verificare quanti IBAN vengono trovati da fonti esterne.
        3.  Eseguire nuovamente il check P0 ().
        4.  Presentare all'utente una lista dei fornitori rimanenti che necessitano di un inserimento manuale dell'IBAN.
    -   **Why fix this issue and what will be achieved with the fix?**: Risolve un blocco P0 che impedisce l'importazione di fatture per un gran numero di fornitori, garantendo la conformità dei dati.
    -   **Status**: NOT STARTED
    -   **Is recurring issue?**: Y
    -   **Should Test frontend/backend/both after fix?**: Backend
    -   **Blocked on other issue**: Issue 1: Completare l'aggiornamento in blocco dei fornitori

**In progress Task List**:
-   **Task 1: Implementare UI per l'aggiornamento in blocco dei fornitori (P0)**
    -   **Where to resume**: . Aggiungere un pulsante e la logica di chiamata API come descritto nell'Issue 1.
    -   **What will be achieved with this?**: Completerà la funzionalità richiesta dall'utente per la gestione massiva dei fornitori.
    -   **Status**: IN PROGRESS
    -   **Should Test frontend/backend/both after fix?**: both
    -   **Blocked on something**: No.

**Upcoming and Future Tasks**
-   **Upcoming Tasks**:
    -   (P1) **Verifica Funzionamento Validatori P0**: Chiedere all'utente di testare l'importazione di una fattura per un fornitore con dati volutamente errati (es. senza IBAN) per confermare che il blocco funzioni.
    -   (P2) **Svuotamento PDF**: Eseguire un comando più approfondito per rimuovere tutti i file PDF non necessari dalle varie cartelle (, , ecc.).
-   **Future Tasks**:
    -   (P1) Finalizzare l'importazione dei cedolini da PDF (estrazione OCR dei dati).
    -   (P2) Unificare le anagrafiche  e .
    -   (P2) Sviluppare una Dashboard Analytics.
    -   (P2) Implementare l'integrazione con Google Calendar.
    -   (P2) Generare e inviare report in PDF via email.

**Completed work in this session**
-   **UI Refactoring (Prima Nota e Salari)**: Le pagine  e  sono state create/sostituite copiando il codice da un progetto di riferimento, implementando il design richiesto.
-   **Implementazione Validatori P0**: Aggiunti validatori bloccanti per fatture (mancanza metodo di pagamento/IBAN) e salari (pagamento in contanti post 06/2018).
-   **Fix Gestione Fornitori**: Risolto un bug che nascondeva il pulsante Cerca P.IVA e implementato un endpoint per sincronizzare gli IBAN dalle fatture.
-   **Fix Bug Conferma Multipla**: Risolto errore 400 durante la conferma in batch di fatture.
-   **Fix e Refactoring Sezione F24**: La UI è stata corretta per mostrare gli importi totali e permettere la conferma.
-   **Fix Import Dati**: Corrette le procedure di importazione per Corrispettivi XML e Cedolini da Excel.
-   **Automatizzazione Riconciliazione**: Implementata una logica di auto-assegnazione dei metodi di pagamento con refresh automatico.
-   **Endpoint Bulk Update**: Creato un endpoint backend per l'aggiornamento massivo dei fornitori.

**Code Architecture**


**Key Technical Concepts**
-   **Backend**: FastAPI, Pydantic, MongoDB.
-   **Frontend**: React, Zustand (per state management).
-   **Logica di Business**: Implementazione di regole contabili complesse e non standard, validatori P0 bloccanti.
-   **Debito Tecnico**: La coesistenza di  e  crea confusione e problemi di hot-reloading.

**key DB schema**
-   ****: Anagrafica fornitori. Fonte di verità per  e .
-   ****: Fatture ricevute.
-   ** / **: Registri contabili separati.
-   ****: Dati delle buste paga.
-   ****: Dati per i pagamenti F24.

**changes in tech stack**
-   È stata introdotta la libreria  nel frontend per la gestione dello stato della nuova UI della Prima Nota.

**All files of reference**
-   
-   
-   
-   
-   
-   
-   
-   

**Areas that need refactoring**:
-   **Struttura del Progetto**: È cruciale completare la migrazione da  a  per risolvere i problemi di hot-reloading e migliorare la manutenibilità.
-   **Unificazione Collection**: Le collection  e  dovrebbero essere unificate.

**key api endpoints**
-    (POST): Nuovo endpoint per aggiornare in massa i fornitori con dati incompleti.
-    (GET): Endpoint per verificare lo stato dei fornitori rispetto ai validatori P0.
-    (POST): Endpoint di importazione fatture dove sono stati aggiunti i validatori P0.
-    (POST): Endpoint di pagamento salari dove è stato aggiunto il validatore P0.

**Critical Info for New Agent**
-   **Hot Reload Inaffidabile**: A causa della doppia struttura  e , le modifiche ai file in  non vengono rilevate dall'hot reload. È necessario riavviare manualmente il backend (backend: stopped
backend: started) dopo ogni modifica in quella directory.
-   **Priorità Utente**: L'utente è molto sensibile ai problemi bloccanti (P0) e alla reattività della UI. L'aggiornamento in blocco dei fornitori e la risoluzione degli IBAN mancanti sono le massime priorità.
-   **Fonte di Verità**: Qualsiasi logica riguardante i fornitori deve usare la collection  come unica fonte di verità.

**documents and test reports created in this job**
-    (aggiornato più volte)
-   
-   

**Last 10 User Messages and any pending HUMAN messages**
1.  **Utente**: Richiesta di correggere la logica dei salari (contanti permessi solo prima di luglio 2018), risolvere i 240 fornitori senza IBAN e investigare errori 404 e problemi di modifica dei fornitori. (Stato: In corso)
2.  **Agente**: Inizia l'investigazione.
3.  **Agente**: Conferma che la ricerca P.IVA e la modifica funzionano, suggerendo che il 404 sia altrove.
4.  **Agente**: Implementa la logica di sync IBAN dalle fatture, riducendo i problemi da 240 a 231.
5.  **Agente**: Scopre e corregge il bug nella UI che nascondeva il pulsante Cerca P.IVA.
6.  **Agente**: Corregge i messaggi e i commenti nel validatore dei salari per riflettere correttamente la legge.
7.  **Utente**: Richiede un pulsante per aggiornare tutti i fornitori contemporaneamente e di usare una fonte dati alternativa a VIES, lamentando ancora errori 404. (Stato: In corso)
8.  **Agente**: Crea l'endpoint backend per l'aggiornamento in blocco.
9.  **Utente**: Invia un'immagine con file .md e chiede di aggiornarli. (Stato: Completato)
10. **Agente**: Esegue l'aggiornamento dei file .md.

**Project Health Check:**
-   **Broken**:
    -   La funzionalità di aggiornamento in blocco dei fornitori è incompleta (manca la parte frontend).
    -   L'importazione delle fatture è bloccata per 231 fornitori a causa della mancanza di IBAN.
-   **Mocked**: Nessuno.
-   **Technical Debt**:
    -   **High**: Struttura del backend duplicata ( e ) che causa problemi di sviluppo e manutenzione.

**3rd Party Integrations**
-   **VIES (tramite )**: Utilizzato per la validazione delle partite IVA. L'agente ha aggiunto altre fonti nel codice ma non sono state specificate.

**Testing status**
-   **Testing agent used after significant changes**: NO
-   **Troubleshoot agent used after agent stuck in loop**: NO
-   **Test files created**: Nessuno.
-   **Known regressions**: Nessuna.

**Credentials to test flow:**
Nessuna credenziale specifica necessaria.

**What agent forgot to execute**
-   L'agente non ha completato l'implementazione della funzionalità di aggiornamento in blocco dei fornitori. L'endpoint backend è stato creato, ma il pulsante e la logica frontend in  non sono stati aggiunti prima che l'utente richiedesse la generazione del sommario.</analysis>
